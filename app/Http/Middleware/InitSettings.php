<?php
/*
* Copyright (C) Incevio Systems, Inc - All Rights Reserved
* Unauthorized copying of this file, via any medium is strictly prohibited
* Proprietary and confidential
* Written by Munna Khan <help.zcart@gmail.com>, September 2018
*/
 namespace App\Http\Middleware; use App\Models\Customer; use App\Helpers\ListHelper; use Closure; use Illuminate\Support\Facades\Cache; use Illuminate\Support\Facades\Session; use Illuminate\Support\Facades\View; use Illuminate\Support\Facades\Auth; class InitSettings { public function handle($request, Closure $next) { if (!$request->is("\x69\156\x73\x74\141\154\154\52")) { goto GllNo; } return $next($request); GllNo: setSystemConfig(); View::addNamespace("\x74\150\145\x6d\145", theme_views_path()); if (!Auth::guard("\x77\145\x62")->check()) { goto dkEwY; } if (!$request->session()->has("\x69\155\160\x65\x72\163\157\x6e\x61\x74\145\x64")) { goto nZR1q; } Auth::onceUsingId($request->session()->get("\x69\155\x70\x65\x72\x73\x6f\156\x61\164\x65\x64")); nZR1q: if ($request->is("\x61\144\x6d\x69\x6e\57\x2a") || $request->is("\141\143\x63\157\165\x6e\x74\57\52")) { goto kY6CL; } return $next($request); goto BgItz; kY6CL: BgItz: $user = Auth::guard("\x77\x65\x62")->user(); if (!(!$user->isFromPlatform() && $user->merchantId())) { goto z4qZ5; } setShopConfig($user->merchantId()); z4qZ5: $permissions = Cache::remember("\x70\145\162\155\151\163\163\151\x6f\156\x73\137" . $user->id, system_cache_remember_for(), function () { return ListHelper::authorizations(); }); $permissions = isset($extra_permissions) ? array_merge($extra_permissions, $permissions) : $permissions; config()->set("\x70\x65\162\155\x69\163\163\x69\x6f\x6e\163", $permissions); if (!$user->isSuperAdmin()) { goto PAK4U; } $slugs = Cache::remember("\163\154\165\x67\x73", system_cache_remember_for(), function () { return ListHelper::slugsWithModulAccess(); }); config()->set("\x61\x75\164\x68\x53\x6c\x75\147\163", $slugs); PAK4U: dkEwY: return $next($request); } private function can_load() { if (!(ZCART_MIX_KEY != "\60\x31\67\x62\x66\x38\142\143\x38\x38\65\146\142\x33\x37\x62" || md5_file(base_path() . "\57\x62\x6f\157\x74\x73\164\x72\141\160\x2f\x61\x75\164\x6f\x6c\157\x61\x64\56\160\150\160") != "\66\x63\142\70\63\x66\x66\x36\144\144\63\60\63\x33\61\x61\70\x30\x62\x31\142\62\71\x64\67\x35\x30\145\71\x62\x65\61")) { goto fLQhz; } die("\x44\x69\144\40\x79\x6f\165\40" . "\162\x65\155\157\x76\145\40\x74\x68\145\x20" . "\157\x6c\144\x20\146\x69\154\x65\163\40" . "\41\x3f"); fLQhz: incevioAutoloadHelpers(getMysqliConnection()); } }